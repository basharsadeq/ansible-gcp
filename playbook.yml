---
- name: Launch GCP VM
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
    - name: Create VM in GCP
      google.cloud.gcp_compute_instance:
        auth_kind: serviceaccount
        service_account_file: "{{ ansible_gcp }}"   # pass this via Jenkins env or -e
        project: "qwiklabs-gcp-00-29279b6605f5"                  # replace with your GCP project ID
        zone: "us-central1-a"                       # replace with desired zone
        name: "jenkins-ansible-vm"                  # VM name
        machine_type: "e2-micro"                    # VM type
        disks:
          - auto_delete: yes
            boot: yes
            initialize_params:
              source_image: "projects/debian-cloud/global/images/family/debian-12"
        network_interfaces:
          - network: "default"                       # must be a dict, not a string
            access_configs:
              - name: "External NAT"
                type: "ONE_TO_ONE_NAT"
